<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云合智慧门店 - 桌位管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        /* 改动位置：body背景色 */
        body {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 50%, #ffcc80 100%);
            color: #333;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        .container {
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 50%, #ffe082 100%);
        }

        header {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            padding: 0px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .header-title i {
            font-size: 28px;
        }


        .main-content {
            padding: 25px;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .dashboard-card.free {
            border-left-color: #2ecc71;
        }

        .dashboard-card.occupied {
            border-left-color: #e74c3c;
        }

        .dashboard-card.reserved {
            border-left-color: #f39c12;
        }

        .dashboard-card h3 {
            font-size: 15px;
            color: #7f8c8d;
            margin-bottom: 12px;
        }

        .dashboard-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }

        .dashboard-card.free .number {
            color: #2ecc71;
        }

        .dashboard-card.occupied .number {
            color: #e74c3c;
        }

        .dashboard-card.reserved .number {
            color: #f39c12;
        }


        .search-box {
            display: flex;
            flex: 1;
            max-width: 400px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px 0 0 6px;
            font-size: 15px;
        }





        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }

        .table-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            border: 2px solid transparent;
        }

        .table-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .table-status {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }

        .status-free {
            background: #2ecc71;
        }

        .status-occupied {
            background: #e74c3c;
        }

        .status-reserved {
            background: #f39c12;
        }

        .table-icon {
            font-size: 36px;
            margin-bottom: 15px;
            color: #3498db;
        }

        .table-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 18px;
            color: #2c3e50;
        }

        .table-capacity {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .table-time {
            color: #95a5a6;
            font-size: 13px;
            margin-top: 8px;
            padding: 5px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .table-item.free {
            border-color: #2ecc71;
        }

        .table-item.free .table-icon {
            color: #2ecc71;
        }

        .table-item.occupied {
            border-color: #e74c3c;
        }

        .table-item.occupied .table-icon {
            color: #e74c3c;
        }

        .table-item.reserved {
            border-color: #f39c12;
        }

        .table-item.reserved .table-icon {
            color: #f39c12;
        }

        .footer-info {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            color: #7f8c8d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-time {
            font-weight: 500;
        }

        .system-info {
            display: flex;
            gap: 15px;
        }

        .system-info a {
            color: #3498db;
            text-decoration: none;
        }

        .system-info a:hover {
            text-decoration: underline;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .modal-body {
            padding: 25px;
        }

        /*.modal-details {*/
            /*display: grid;*/
            /*grid-template-columns: 1fr 1fr;*/
            /*gap: 15px;*/
            /*margin-bottom: 20px;*/
        /*}*/

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 500;
            color: #2c3e50;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .search-box {
                max-width: 100%;
            }

            .dashboard-cards {
                grid-template-columns: 1fr 1fr;
            }

            .tables-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            .footer-info {
                flex-direction: column;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .tables-grid {
                grid-template-columns: 1fr 1fr;
            }

            .modal-details {
                grid-template-columns: 1fr;
            }
        }







        .header-title i {
            font-size: 28px;
        }

        /* 改动位置：搜索框样式 */
        .search-box {
            display: flex;
            flex: 1;
            max-width: 400px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px 0 0 6px;
            font-size: 24px;
            border: 2px solid #ff9800;
        }

        .search-box button {
            padding: 12px 18px;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 0 6px 6px 0;
            cursor: pointer;
            transition: background 0.3s;
            margin-right: 10px;
        }

        .search-box button:hover {
            background: #f57c00;
        }

        /* 改动位置：筛选按钮样式 */
        .filter-buttons {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: white;
            font-size: 24px;
            backdrop-filter: blur(5px);
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .filter-btn.active {
            background: white;
            color: #ff9800;
            border-color: white;
        }

        /* 改动位置：信息显示样式 */
        .xinxi h3 {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            margin: 0;
        }

        /* 改动位置：控制区域样式 */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 152, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 152, 0, 0.2);
        }

        /* 改动位置：数据卡片样式 */
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-left: 5px solid #ff9800;
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
        }

        .dashboard-card.free {
            border-left-color: #4caf50;
        }

        .dashboard-card.occupied {
            border-left-color: #f44336;
        }

        .dashboard-card.reserved {
            border-left-color: #ff9800;
        }

        .dashboard-card h3 {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .dashboard-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #333;
        }

        .dashboard-card.free .number {
            color: #4caf50;
        }

        .dashboard-card.occupied .number {
            color: #f44336;
        }

        .dashboard-card.reserved .number {
            color: #ff9800;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px; /* 增大最大宽度 */
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            transform: scale(1.05); /* 稍微放大 */
            transition: transform 0.3s ease-out;
        }

        .modal-header {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            padding: 25px 30px; /* 增加内边距 */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 24px; /* 增大字体 */
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 32px; /* 增大关闭按钮 */
            cursor: pointer;
            color: white;
            transition: transform 0.2s;
        }

        .close-modal:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px; /* 增加内边距 */
        }

        /*.modal-details {*/
            /*display: grid;*/
            /*grid-template-columns: 1fr 1fr;*/
            /*gap: 20px; !* 增加间距 *!*/
            /*margin-bottom: 25px;*/
        /*}*/

        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .detail-label {
            font-size: 16px; /* 增大字体 */
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 20px; /* 增大字体 */
            font-weight: 600;
            color: #2c3e50;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px; /* 增加间距 */
            padding: 25px 30px; /* 增加内边距 */
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 14px 25px; /* 增大按钮 */
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 16px; /* 增大字体 */
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-width: 95%;
            }

            .modal-details {
                grid-template-columns: 1fr;
            }

            .modal-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .modal-header {
                padding: 20px;
            }

            .modal-body {
                padding: 20px;
            }

            .modal-title {
                font-size: 20px;
            }

            .detail-label {
                font-size: 14px;
            }

            .detail-value {
                font-size: 18px;
            }
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .pagination-btn {
            padding: 8px 16px;
            background-color: #4e73df;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: #2e59d9;
        }

        .pagination-btn:disabled {
            background-color: #b7b7b7;
            cursor: not-allowed;
        }

        .page-info {
            font-weight: 600;
            color: #5a5c69;
            font-size: 30px;
        }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #pageSize {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #d1d3e2;
            font-size: 25px;
        }

        .pagination-placeholder {
            height: 60px;
        }

        /* 添加预约时间显示的样式 */
        .reservation-time {
            font-size: 12px;
            color: #e67e22;
            margin-top: 5px;
            font-weight: bold;
        }

        /* 表单组样式 */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }


        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            min-width: 700px;

        }


    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="header-title">
            <i class="fas fa-utensils"></i>
            <h1>云合智慧桌位管理</h1>
        </div>
        <div class="controls">
            <div class="search-box">
                <input type="text" placeholder="搜索桌位名称...">
                <button><i class="fas fa-search" style="font-size: 24px"></i></button>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active">全部</button>
                <button class="filter-btn">空闲中</button>
                <button class="filter-btn">已占用</button>
                <button class="filter-btn">已预订</button>
            </div>

            <div class="filter-buttons2" style="margin-left: 20px;">
                <button class="filter-btn" id="clean">清空所有桌位</button>
            </div>
        </div>
        <div class="xinxi">
            <h3>当前时间：2025/09/10 16:40:15</h3>
        </div>
    </header>

    <div class="main-content">
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <h2>总桌位数量</h2>
                <div class="number">0</div>
            </div>
            <div class="dashboard-card free">
                <h2>空闲桌位</h2>
                <div class="number">0</div>
            </div>
            <div class="dashboard-card occupied">
                <h2>已占用</h2>
                <div class="number">0</div>
            </div>
            <div class="dashboard-card reserved">
                <h2>已预订</h2>
                <div class="number">0</div>
            </div>
        </div>

        <div class="tables-grid">
            <!-- 动态生成的桌位数据 -->
            <% if (data && data.length > 0) { %>
            <% data.forEach(function(table) { %>
            <div class="table-item
            <% if (table.zt === '1') { %>free<% } %>
            <% if (table.zt === '2') { %>reserved<% } %>
            <% if (table.zt === '3') { %>occupied<% } %>">

                <div class="table-status
                <% if (table.zt === '1') { %>status-free<% } %>
                <% if (table.zt === '2') { %>status-reserved<% } %>
                <% if (table.zt === '3') { %>status-occupied<% } %>">
                </div>

                <div class="table-icon">
                    <% if (parseInt(table.zx) >= 8) { %>
                    <i class="fas fa-couch"></i>
                    <% } else { %>
                    <i class="fas fa-chair"></i>
                    <% } %>
                </div>

                <div class="table-name"><%= table.zh %></div>
                <div class="table-capacity"><%= table.zx %>人桌</div>
            </div>
            <% }); %>
            <% } else { %>
            <div class="no-data">暂无桌位数据</div>
            <% } %>
        </div>

        <!-- 分页控件 -->
        <div class="pagination-controls">
            <button id="prevPage" class="pagination-btn" disabled>
                <i class="fas fa-chevron-left"></i> 上一页
            </button>
            <span class="page-info">第 <span id="currentPage">1</span> 页 / 共 <span id="totalPages">1</span> 页</span>
            <button id="nextPage" class="pagination-btn">
                下一页 <i class="fas fa-chevron-right"></i>
            </button>
            <div class="page-size-selector">
                <label style="font-size: 25px;">每页显示:</label>
                <select id="pageSize">
                    <option value="2" style="font-size: 15px;">2张桌位</option>
                    <option value="12" style="font-size: 15px;" selected>12张桌位</option>
                    <option value="16" style="font-size: 15px;">16张桌位</option>
                    <option value="20" style="font-size: 15px;">20张桌位</option>
                </select>
            </div>
        </div>
        <!--&lt;!&ndash; 分页占位符，确保内容不会溢出 &ndash;&gt;-->
        <!--<div class="pagination-placeholder"></div>-->
    </div>
</div>
<!-- 桌位详情模态框 -->
<div class="modal" id="tableModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">桌位详情</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="modal-details">
                <div class="detail-item">
                    <span class="detail-label">桌位编号</span>
                    <span class="detail-value">A01</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">容量</span>
                    <span class="detail-value">4人</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">状态</span>
                    <span class="detail-value">空闲中</span>
                </div>
                <!--<div class="detail-item">-->
                    <!--<span class="detail-label">消费单号</span>-->
                    <!--<span class="detail-value"></span>-->
                <!--</div>-->
                <!--<div class="detail-item">-->
                    <!--<span class="detail-label">消费金额</span>-->
                    <!--<span class="detail-value">0</span>-->
                <!--</div>-->
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-danger">关闭弹窗</button>
            <button class="btn btn-warning" style="background-color: yellow">取消状态</button>
            <button class="btn btn-success">安排入座</button>
            <button class="btn btn-light" style="background-color: #20c41e">预约</button>
            <button class="btn jiesuan" style="background-color: #0b96c4">结算</button>
        </div>
    </div>
</div>

<div class="modal" id="reservationModal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2 class="modal-title">预约时间</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="modal-details">
                <div class="form-group">
                    <label for="reservationTime">选择时间</label>
                    <input type="time" id="reservationTime" class="form-control">
                </div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-danger" id="cancelReservation">取消</button>
            <button class="btn " id="confirmReservation">确认预约</button>
        </div>
    </div>
</div>

<script>

    // 分页相关变量
    let currentPage = 1;
    let pageSize = 12;
    let totalTables = 0;
    let filteredData = [];
    let currentFilter = 'all';
    let currentSearch = '';

    // 初始化分页
    function initPagination() {
        // 监听每页显示数量变化
        $('#pageSize').on('change', function() {
            pageSize = parseInt($(this).val());
            currentPage = 1;
            renderTables();
            updatePaginationControls();
        });

        // 上一页按钮
        $('#prevPage').on('click', function() {
            if (currentPage > 1) {
                currentPage--;
                renderTables();
                updatePaginationControls();
            }
        });

        // 下一页按钮
        $('#nextPage').on('click', function() {
            if (currentPage < Math.ceil(totalTables / pageSize)) {
                currentPage++;
                renderTables();
                updatePaginationControls();
            }
        });
    }



    // 更新分页控件状态
    function updatePaginationControls() {
        const totalPages = Math.ceil(totalTables / pageSize);

        // 更新页面信息
        $('#currentPage').text(currentPage);
        $('#totalPages').text(totalPages);

        // 更新按钮状态
        $('#prevPage').prop('disabled', currentPage <= 1);
        $('#nextPage').prop('disabled', currentPage >= totalPages);
    }

    function renderTables() {
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, filteredData.length);
        const currentPageData = filteredData.slice(startIndex, endIndex);

        // 清空现有的桌位数据
        $('.tables-grid').empty();

        if (currentPageData.length > 0) {
            // 动态生成桌位数据
            currentPageData.forEach(function(table) {
                // 确定状态类名
                let statusClass = '';
                let statusText = '';
                let timeHtml = '';

                if (table.zt === '1') {
                    statusClass = 'free';
                    statusText = 'status-free';
                } else if (table.zt === '2') {
                    statusClass = 'reserved';
                    statusText = 'status-reserved';
                    timeHtml = `<div class="table-time">时间:${table.sj}</div>`;
                } else if (table.zt === '3') {
                    statusClass = 'occupied';
                    statusText = 'status-occupied';
                    timeHtml = `<div class="table-time">编号:${table.bm}</div>`;
                }

                // 确定图标
                let iconClass = parseInt(table.zx) >= 8 ? 'fas fa-couch' : 'fas fa-chair';

                // 创建桌位HTML
                let tableHtml = `
                    <div class="table-item ${statusClass}">
                        <div class="table-status ${statusText}"></div>
                        <div class="table-icon"><i class="${iconClass}"></i></div>
                        <div class="table-name">${table.zh}</div>
                        <div class="table-capacity">${table.zx}人桌</div>
                        ${timeHtml}
                    </div>
                `;

                // 添加到容器
                $('.tables-grid').append(tableHtml);
            });
        } else {
            // 没有数据时显示提示
            $('.tables-grid').html('<div class="no-data">暂无桌位数据</div>');
        }

        // 更新分页控件
        updatePaginationControls();
    }


    var globalTableBanhao;

    // 使用事件委托处理动态生成的元素
    $(document).on('click', '.table-item', function() {
        // 获取点击元素的tablename和tablecapacity值
        const tablename = $(this).find('.table-name').text();
        const tablecapacity = $(this).find('.table-capacity').text();
        const tablebanhao = $(this).find('.table-time').text();
        globalTableBanhao = tablebanhao.split(':')[1];
        // 显示模态框
        $('#tableModal').css('display', 'block');

        // 替换模态框中的内容
        $('#tableModal').find('.detail-value').eq(0).text(tablename);
        $('#tableModal').find('.detail-value').eq(1).text(tablecapacity);

        // 根据状态设置不同的显示
        if ($(this).hasClass('free')) {
            $('#tableModal').find('.detail-value').eq(2).text('空闲中');
        } else if ($(this).hasClass('reserved')) {
            $('#tableModal').find('.detail-value').eq(2).text('已预订');
        } else if ($(this).hasClass('occupied')) {
            $('#tableModal').find('.detail-value').eq(2).text('已占用');
        }
    });

    // 关闭模态框的功能
    $('.close-modal').on('click', function() {
        $('#tableModal').css('display', 'none');
    });

    // 点击模态框外部关闭
    $(window).on('click', function(event) {
        if ($(event.target).is('#tableModal')) {
            $('#tableModal').css('display', 'none');
        }
    });

    // 按钮功能
    $('.btn-danger').on('click', function() {
        $('#tableModal').css('display', 'none');
    });

    function getCurrentTableNumber() {
        // 查找模态框中桌位编号的元素
        const tableNumberElement = document.querySelector('#tableModal .detail-item:first-child .detail-value');

        // 如果找到元素，返回其文本内容
        if (tableNumberElement) {
            return tableNumberElement.textContent;
        }

        // 如果没有找到，返回null或空字符串
        return null;
    }

    // $('.btn-success').on('click', function() {
    //
    //     const tableNumber = getCurrentTableNumber();
    //     uptableRequest(tableNumber)
    //
    //     alert(`已安排入座到桌位: ${tableNumber}`);
    //
    //     $('#tableModal').css('display', 'none');
    //
    //     window.open('/order_panel/select?tableNumber=' + tableNumber, 'main');
    //
    // });

    // $('.btn-success').on('click', function() {
    //     const tableNumber = getCurrentTableNumber();
    //
    //     localStorage.setItem('currentTableNumber', tableNumber);
    //
    //     uptableRequest(tableNumber);
    //     alert(`已安排入座到桌位: ${tableNumber}`);
    //     $('#tableModal').css('display', 'none');
    //
    //     window.open('/order_panel/select', 'main');
    // });

    $('.btn-success').on('click', function() {
        const tableNumber = getCurrentTableNumber();

        uptableRequest(tableNumber);
        alert(`已安排入座到桌位: ${tableNumber}`);
        $('#tableModal').css('display', 'none');
        localStorage.setItem('currentTableNumber', tableNumber);

        // 通过URL参数传递，而不是localStorage
        window.open('/order_panel/select', 'main');

    });

// 将所有桌位改为空桌
    $('#clean').on('click', function() {
        uptableRequestAll1()
    });


    $('.jiesuan').on('click', function() {
        const tableNumber = getCurrentTableNumber();

        localStorage.setItem('currentTableNumber', tableNumber);
        window.open('/order_panel/select', 'main');
        // uptableRequest1(tableNumber);
        // setTimeout(function() {
        //     uptableRequest1(tableNumber);
        // }, 10000); // 1秒延迟，可根据需要调整

        $('#tableModal').css('display', 'none');

    });

    // 更新模态框数据的函数
    function updateModalData(tableNumber, danhao, totalAmount) {
        // 存储数据到localStorage
        localStorage.setItem('modalData_' + tableNumber, JSON.stringify({
            danhao: danhao,
            totalAmount: totalAmount,
            timestamp: new Date().getTime()
        }));

        // 更新模态框显示
        $('#tableModal').find('.detail-item:nth-child(4) .detail-value').text(danhao);
        $('#tableModal').find('.detail-item:nth-child(5) .detail-value').text(totalAmount);
    }

    // 监听来自其他页面的消息
    window.addEventListener('message', function(event) {
        if (event.data.type === 'orderDataUpdated') {
            const tableNumber = event.data.tableNumber;
            const danhao = event.data.danhao;
            const totalAmount = event.data.totalAmount;

            // 更新模态框数据
            updateModalData(tableNumber, danhao, totalAmount);
        }
    });

    $('.btn-warning').on('click', function() {

        const tableNumber = getCurrentTableNumber();
        uptableRequest1(tableNumber)

        alert(`已清空桌位: ${tableNumber}`);

        $('#tableModal').css('display', 'none');
    });

    // 存储预约信息的对象
    let reservationData = {};

    // 打开预约模态框
    function openReservationModal(tableNumber) {
        $('#reserveTableName').text(tableNumber);


        // 设置默认时间为当前时间+30分钟
        const now = new Date();
        now.setMinutes(now.getMinutes() + 30);

        const dateString = now.toISOString().split('T')[0];
        const timeString = now.toTimeString().substr(0, 5);

        $('#reservationDate').val(dateString);
        $('#reservationTime').val(timeString);

        $('#reservationModal').css('display', 'block');
    }

    // 确认预约
    $('#confirmReservation').on('click', function() {
        const tableNumber = $('#reserveTableName').text();
        const reservationDate = $('#reservationDate').val();
        const reservationTime = $('#reservationTime').val();



        if (!reservationTime) {
            alert('请选择预约时间');
            return;
        }

        const shijian = reservationTime

        // 更新桌位状态为已预订
        const tableNumber1 = getCurrentTableNumber();
        uptableRequest2(tableNumber1,shijian)

        // 关闭预约模态框
        $('#reservationModal').css('display', 'none');
        $('#reservationModal').css('display', 'none');

        // 刷新页面数据
        selectAll();

        alert(`已预约桌位: ${tableNumber}, 时间:${reservationTime}`);
    });

    // 取消预约
    $('#cancelReservation').on('click', function() {
        $('#reservationModal').css('display', 'none');
    });

    // 修改原有的预约按钮点击事件
    $('.btn-light').on('click', function() {
        const tableNumber = getCurrentTableNumber();

        // 关闭详情模态框，打开预约模态框
        $('#tableModal').css('display', 'none');
        openReservationModal(tableNumber);
    });

    // 关闭预约模态框
    $('#reservationModal .close-modal').on('click', function() {
        $('#reservationModal').css('display', 'none');
    });

    // 点击预约模态框外部关闭
    $(window).on('click', function(event) {
        if ($(event.target).is('#reservationModal')) {
            $('#reservationModal').css('display', 'none');
        }
    });


    $('.search-box button').on('click', function() {
        // 获取输入框的值
        let filterValue = $('.search-box input').val().trim();

        // 发送搜索请求
        sendSearchRequest(filterValue);
    });

    $('.filter-btn').on('click', function() {

        $('.filter-btn').removeClass('active');

        $(this).addClass('active');

        let filterValue = '';
        const buttonText = $(this).text();

        if (buttonText === '空闲中') {
            filterValue = '1';
        } else if (buttonText === '已占用') {
            filterValue = '3';
        } else if (buttonText === '已预订') {
            filterValue = '2';
        }
        sendFilterRequest(filterValue);
    });


    // function sendFilterRequest(filterValue) {
    //     $.ajax({
    //         type: 'post',
    //         url: '/order_table/selectnum',
    //         async: false,
    //         timeout: 5000,
    //         data: {
    //             zt: filterValue
    //         },
    //         success: function(res) {
    //             console.log("筛选请求结果", res);
    //
    //             if (res.success && res.data && res.data.length > 0) {
    //                 // 清空现有的桌位数据
    //                 $('.tables-grid').empty();
    //
    //                 // 动态生成桌位数据
    //                 res.data.forEach(function(table) {
    //                     // 确定状态类名
    //                     let statusClass = '';
    //                     let statusText = '';
    //                     let timeHtml = '';
    //
    //                     if (table.zt === '1') {
    //                         statusClass = 'free';
    //                         statusText = 'status-free';
    //                     } else if (table.zt === '2') {
    //                         statusClass = 'reserved';
    //                         statusText = 'status-reserved';
    //                         timeHtml = `<div class="table-time">时间:${table.sj}</div>`;
    //                     } else if (table.zt === '3') {
    //                         statusClass = 'occupied';
    //                         statusText = 'status-occupied';
    //                         timeHtml = `<div class="table-time">编号:${table.bm}</div>`;
    //                     }
    //
    //                     // 确定图标
    //                     let iconClass = parseInt(table.zx) >= 8 ? 'fas fa-couch' : 'fas fa-chair';
    //
    //                     // 创建桌位HTML
    //                     let tableHtml = `
    //                     <div class="table-item ${statusClass}">
    //                         <div class="table-status ${statusText}"></div>
    //                         <div class="table-icon"><i class="${iconClass}"></i></div>
    //                         <div class="table-name">${table.zh}</div>
    //                         <div class="table-capacity">${table.zx}人桌</div>
    //                         ${timeHtml}
    //                     </div>
    //                 `;
    //
    //                     // 添加到容器
    //                     $('.tables-grid').append(tableHtml);
    //                 });
    //             } else {
    //                 // 没有数据时显示提示
    //                 $('.tables-grid').html('<div class="no-data">暂无桌位数据</div>');
    //             }
    //         },
    //         error: function(res) {
    //             if (res.status == "timeout") {
    //                 alert("网络超时，请稍后再试");
    //             } else {
    //                 alert("网络错误，请稍后再试");
    //             }
    //             // 错误时显示提示
    //             $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
    //         }
    //     });
    // }

    function sendFilterRequest(filterValue) {
        $.ajax({
            type: 'post',
            url: '/order_table/selectnum',
            async: false,
            timeout: 5000,
            data: {
                zt: filterValue
            },
            success: function(res) {
                console.log("筛选请求结果", res);
                currentFilter = filterValue || 'all';
                currentSearch = '';

                if (res.success && res.data && res.data.length > 0) {
                    filteredData = res.data;
                    totalTables = filteredData.length;
                    currentPage = 1;
                    renderTables();
                } else {
                    filteredData = [];
                    totalTables = 0;
                    renderTables();
                }
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
                // 错误时显示提示
                $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
            }
        });
    }

    // function sendSearchRequest(filterValue) {
    //     $.ajax({
    //         type: 'post',
    //         url: '/order_table/selectsea',
    //         async: false,
    //         timeout: 5000,
    //         data: {
    //             zh: filterValue
    //         },
    //         success: function(res) {
    //             console.log("筛选请求结果", res);
    //
    //             if (res.success && res.data && res.data.length > 0) {
    //                 // 清空现有的桌位数据
    //                 $('.tables-grid').empty();
    //
    //                 // 动态生成桌位数据
    //                 res.data.forEach(function(table) {
    //                     // 确定状态类名
    //                     let statusClass = '';
    //                     let statusText = '';
    //                     let timeHtml = '';
    //
    //                     if (table.zt === '1') {
    //                         statusClass = 'free';
    //                         statusText = 'status-free';
    //                     } else if (table.zt === '2') {
    //                         statusClass = 'reserved';
    //                         statusText = 'status-reserved';
    //                         timeHtml = `<div class="table-time">预订:${table.sj}</div>`;
    //                     } else if (table.zt === '3') {
    //                         statusClass = 'occupied';
    //                         statusText = 'status-occupied';
    //                         timeHtml = `<div class="table-time">编号:${table.bm}</div>`;
    //                     }
    //
    //                     // 确定图标
    //                     let iconClass = parseInt(table.zx) >= 8 ? 'fas fa-couch' : 'fas fa-chair';
    //
    //                     // 创建桌位HTML
    //                     let tableHtml = `
    //                     <div class="table-item ${statusClass}">
    //                         <div class="table-status ${statusText}"></div>
    //                         <div class="table-icon"><i class="${iconClass}"></i></div>
    //                         <div class="table-name">${table.zh}</div>
    //                         <div class="table-capacity">${table.zx}人桌</div>
    //                         ${timeHtml}
    //                     </div>
    //                 `;
    //
    //                     // 添加到容器
    //                     $('.tables-grid').append(tableHtml);
    //                 });
    //             } else {
    //                 // 没有数据时显示提示
    //                 $('.tables-grid').html('<div class="no-data">暂无桌位数据</div>');
    //             }
    //         },
    //         error: function(res) {
    //             if (res.status == "timeout") {
    //                 alert("网络超时，请稍后再试");
    //             } else {
    //                 alert("网络错误，请稍后再试");
    //             }
    //             // 错误时显示提示
    //             $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
    //         }
    //     });
    // }

    function sendSearchRequest(filterValue) {
        $.ajax({
            type: 'post',
            url: '/order_table/selectsea',
            async: false,
            timeout: 5000,
            data: {
                zh: filterValue
            },
            success: function(res) {
                console.log("搜索请求结果", res);
                currentSearch = filterValue;
                currentFilter = 'all';

                if (res.success && res.data && res.data.length > 0) {
                    filteredData = res.data;
                    totalTables = filteredData.length;
                    currentPage = 1;
                    renderTables();
                } else {
                    filteredData = [];
                    totalTables = 0;
                    renderTables();
                }
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
                // 错误时显示提示
                $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
            }
        });
    }

    function uptableRequest(filterValue) {
        $.ajax({
            type: 'post',
            url: '/order_table/updatetale',
            async: false,
            timeout: 5000,
            data: {
                zh: filterValue
            },
            success: function(res) {
                console.log("筛选请求结果", res);
                selectAll()
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
                // 错误时显示提示
                $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
            }
        });
    }

    function uptableRequest1(filterValue) {
        $.ajax({
            type: 'post',
            url: '/order_table/updatetale1',
            async: false,
            timeout: 5000,
            data: {
                zh: filterValue
            },
            success: function(res) {
                console.log("筛选请求结果", res);
                selectAll()
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
                // 错误时显示提示
                $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
            }
        });
    }



    function uptableRequestAll1() {
        $.ajax({
            type: 'post',
            url: '/order_table/updatetaleall1',
            async: false,
            timeout: 5000,
            success: function(res) {
                console.log("筛选请求结果", res);
                selectAll()
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
                // 错误时显示提示
                $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
            }
        });
    }

    function uptableRequest2(filterValue,shijian) {
        $.ajax({
            type: 'post',
            url: '/order_table/updatetale2',
            async: false,
            timeout: 5000,
            data: {
                zh: filterValue,
                sj:shijian
            },
            success: function(res) {
                console.log("筛选请求结果", res);
                selectAll()
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
                // 错误时显示提示
                $('.tables-grid').html('<div class="no-data">数据加载失败</div>');
            }
        });
    }

    function selectAll() {
        $.ajax({
            type: 'post',
            url: '/order_table/select',
            async: false,
            timeout: 5000,
            success: function(res) {
                console.log("进入桌位请求", res);
                currentFilter = 'all';
                currentSearch = '';

                if (res.success && res.data && res.data.length > 0) {
                    // 计算各种状态的桌位数量
                    let totalTablesCount = res.data.length;
                    let freeTables = res.data.filter(table => table.zt === '1').length;
                    let reservedTables = res.data.filter(table => table.zt === '2').length;
                    let occupiedTables = res.data.filter(table => table.zt === '3').length;

                    // 更新统计卡片
                    $('.dashboard-cards .dashboard-card:eq(0) .number').text(totalTablesCount);
                    $('.dashboard-cards .dashboard-card:eq(1) .number').text(freeTables);
                    $('.dashboard-cards .dashboard-card:eq(2) .number').text(occupiedTables);
                    $('.dashboard-cards .dashboard-card:eq(3) .number').text(reservedTables);

                    // 设置分页数据
                    filteredData = res.data;
                    totalTables = filteredData.length;
                    currentPage = 1;
                    renderTables();
                } else {
                    // 没有数据时显示提示
                    filteredData = [];
                    totalTables = 0;
                    renderTables();

                    // 重置统计卡片为0
                    $('.dashboard-cards .dashboard-card .number').text('0');
                }
            },
            error: function(res) {
                if (res.status == "timeout") {
                    alert("网络超时，请稍后再试");
                } else {
                    alert("网络错误，请稍后再试");
                }
            }
        });
    }

    // function selectAll() {
    //     $.ajax({
    //         type: 'post',
    //         url: '/order_table/select',
    //         async:false,
    //         timeout: 5000,
    //         success: function(res){
    //             console.log("进入桌位请求",res)
    //             if (res.success && res.data && res.data.length > 0) {
    //                 // 计算各种状态的桌位数量
    //                 let totalTables = res.data.length;
    //                 let freeTables = res.data.filter(table => table.zt === '1').length;
    //                 let reservedTables = res.data.filter(table => table.zt === '2').length;
    //                 let occupiedTables = res.data.filter(table => table.zt === '3').length;
    //
    //                 // 更新统计卡片
    //                 $('.dashboard-cards .dashboard-card:eq(0) .number').text(totalTables);
    //                 $('.dashboard-cards .dashboard-card:eq(1) .number').text(freeTables);
    //                 $('.dashboard-cards .dashboard-card:eq(2) .number').text(occupiedTables);
    //                 $('.dashboard-cards .dashboard-card:eq(3) .number').text(reservedTables);
    //
    //                 // 清空现有的桌位数据
    //                 $('.tables-grid').empty();
    //
    //                 // 动态生成桌位数据
    //                 res.data.forEach(function(table) {
    //                     // 确定状态类名
    //                     let statusClass = '';
    //                     let statusText = '';
    //                     let timeHtml = '';
    //
    //                     if (table.zt === '1') {
    //                         statusClass = 'free';
    //                         statusText = 'status-free';
    //                     } else if (table.zt === '2') {
    //                         statusClass = 'reserved';
    //                         statusText = 'status-reserved';
    //
    //                         timeHtml = `<div class="table-time">预订:${table.sj}</div>`;
    //                         // 获取预约时间（如果有）
    //                         // const reservationInfo = reservationData[table.zh];
    //                         // if (reservationInfo && reservationInfo.time) {
    //                         //     // 只显示时间部分（HH:MM）
    //                         //     const timeOnly = reservationInfo.time;
    //                         //     timeHtml = `<div class="table-time">预订: ${timeOnly}</div>`;
    //                         // } else {
    //                         //     timeHtml = '<div class="table-time">已预订</div>';
    //                         // }
    //                     } else if (table.zt === '3') {
    //                         statusClass = 'occupied';
    //                         statusText = 'status-occupied';
    //                         timeHtml = `<div class="table-time">编号:${table.bm}</div>`;
    //                     }
    //
    //                     // 确定图标
    //                     let iconClass = parseInt(table.zx) >= 8 ? 'fas fa-couch' : 'fas fa-chair';
    //
    //                     // 创建桌位HTML
    //                     let tableHtml = `
    //                         <div class="table-item ${statusClass}">
    //                             <div class="table-status ${statusText}"></div>
    //                             <div class="table-icon"><i class="${iconClass}"></i></div>
    //                             <div class="table-name">${table.zh}</div>
    //                             <div class="table-capacity">${table.zx}人桌</div>
    //                             ${timeHtml}
    //                         </div>
    //                     `;
    //
    //                     // 添加到容器
    //                     $('.tables-grid').append(tableHtml);
    //                 });
    //             } else {
    //                 // 没有数据时显示提示
    //                 $('.tables-grid').html('<div class="no-data">暂无桌位数据</div>');
    //
    //                 // 重置统计卡片为0
    //                 $('.dashboard-cards .dashboard-card .number').text('0');
    //             }
    //         },
    //         error: function(res){
    //             if(res.status == "timeout"){
    //                 alert("网络超时，请稍后再试")
    //             }else{
    //                 alert("网络错误，请稍后再试")
    //             }
    //         }
    //     });
    // }

    function tableShow(){
        $.ajax({
            type: 'post',
            url: '/order_table/ass',
            async:false,
            timeout: 5000,
            success: function(){
                console.log("进入页面请求")
                selectAll()
            },
            error: function(res){
                if(res.status == "timeout"){
                    alert("网络超时，请稍后再试")
                }else{
                    alert("网络错误，请稍后再试")
                }
            }
        });

    }



    function updateDateTime() {
        const now = new Date();
        const timeElement = document.querySelector('.xinxi h3');

        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');

        timeElement.innerHTML = `<i class="fas fa-clock"></i> 当前时间：${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
    }

    // 初始更新一次
    updateDateTime();

    // 每秒更新一次时间
    setInterval(updateDateTime, 1000);
    //
    // window.addEventListener('DOMContentLoaded', () => {
    //     console.log("初始化")
    //     tableShow();
    // });
    window.addEventListener('DOMContentLoaded', () => {
        console.log("初始化");
        initPagination();
        tableShow();
    });
</script>
</body>
</html>